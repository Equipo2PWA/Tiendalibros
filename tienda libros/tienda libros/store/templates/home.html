{% extends 'base.html' %}
{% block title %}Librería{% endblock %}

{% block content %}
<div class="hero-section">
        <div class="hero-button-container">
            <a href="#libros" class="btn btn-primary btn-lg">Explorar Libros</a>
        </div>
    </div>
<div class="container my-4" id="libros">
    <h2 class="mb-4">Nuestros Libros</h2>

    <div class="btn-group mb-4" role="group">
        <a href="{% url 'home' %}" 
           class="btn btn-outline-primary {% if not tipo_actual %}active{% endif %}">
            Todos
        </a>
        <a href="{% url 'home' %}?tipo=virtual" 
           class="btn btn-outline-success {% if tipo_actual == 'virtual' %}active{% endif %}">
            Libros Virtuales (Leer Gratis)
        </a>
        <a href="{% url 'home' %}?tipo=fisico" 
           class="btn btn-outline-danger {% if tipo_actual == 'fisico' %}active{% endif %}">
            Libros Físicos (Comprar)
        </a>
    </div>

    <p class="text-muted">
        Mostrando <strong>{{ books|length }}</strong> 
        libro{{ books|length|pluralize }}
        {% if tipo_actual == 'virtual' %}(lectura online gratis)
        {% elif tipo_actual == 'fisico' %}(envío físico)
        {% endif %}
    </p>

    {% if books %}
    <div class="row">
        {% for book in books %}
        <div class="col-md-4 mb-4">
            <div class="card h-100 shadow-sm">
                {% if book.cover_image %}
                    <img src="{{ book.cover_image.url }}" class="card-img-top" style="height: 250px; object-fit: cover;">
                {% else %}
                    <div class="bg-light text-center p-5" style="height: 250px;">
                        <h5 class="text-muted">Sin portada</h5>
                    </div>
                {% endif %}

                <div class="card-body d-flex flex-column">
                    <h5 class="card-title">{{ book.title }}</h5>
                    <p class="card-text text-muted">por {{ book.author }}</p>
                    <p class="card-text"><strong>${{ book.price }}</strong></p>

                    <div class="mt-auto">
                        {% if book.is_virtual and book.ebook_file %}
                            <a href="{% url 'read_ebook' book.id %}" class="btn btn-success w-100">
                                Leer Ahora
                            </a>
                        {% else %}
                            <a href="{% url 'book_detail' book.id %}" class="btn btn-primary w-100">
                                Ver Detalles / Comprar
                            </a>
                        {% endif %}
                    </div>
                </div>

                <div class="card-footer text-center small">
                    {% if book.is_virtual %}
                        <span class="badge bg-success">Lectura Online Gratis</span>
                    {% else %}
                        <span class="badge bg-danger">Libro Físico</span>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
        <div class="alert alert-info text-center">
            <h4>No hay libros en esta categoría aún.</h4>
        </div>
    {% endif %}
</div>
{% endblock %}